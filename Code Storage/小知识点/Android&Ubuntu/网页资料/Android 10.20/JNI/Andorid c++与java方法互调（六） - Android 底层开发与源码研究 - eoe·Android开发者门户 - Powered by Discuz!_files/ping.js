(function(){var _d,_l,_b,_n="-",_params,_curDomain,_curUrl,_domainToSet,_refDomain,_refUrl,_image;var _v=0,_bc=0;function tcss(params){this.url=[];this.init(params)}tcss.prototype={init:function(params){params?_params=params:_params={};_d=document;if(!(_params.statIframe)){if(window!=top){try{_d=top.document}catch(e){}}}_l=_d.location;_b=_d.body},run:function(){if(_cookie.get("pgv_pvi=",true)==_n){_v=1}_cookie.init();this.url.push(this.getDomainInfo());this.url.unshift("http://pingtcss.qq.com/pingd?");this.url.push(this.getRefInfo(_params));try{if(navigator.cookieEnabled){this.url.push("&pvi="+_cookie.setCookie("pgv_pvi",true))}else{this.url.push("&pvi=NoCookie")}}catch(e){this.url.push("&pvi=NoCookie")}this.url.push("&si="+_cookie.setCookie("ssi"));this.url.push(this.getInterfaceInfo());this.url.push(this.getMainEnvInfo());this.url.push(this.getExtendEnvInfo());_params.extraParams?this.url.push("&ext="+_params.extraParams+";bc="+_bc+_ad.getFinalStr()):this.url.push("&ext=bc="+_bc+_ad.getFinalStr());_cookie.save();typeof(_speedMark)=="undefined"?this.url.push("&r3=0"):this.url.push("&r3="+(new Date()-_speedMark));this.sendInfo(this.url.join(""));if(_params.hot){}},getInterfaceInfo:function(){var _dP="";if(_params.discuzParams){if(_params.discuzParams.ui){_dP+="&ui="+_params.discuzParams.ui}else{_dP+="&ui=0"}if(_params.discuzParams.ty){_dP+="&ty="+_params.discuzParams.ty}else{_dP+="&ty="+_v}if(_params.discuzParams.fi){_dP+="&fi="+_params.discuzParams.fi}if(_params.discuzParams.gi){_dP+="&gi="+_params.discuzParams.gi}if(_params.discuzParams.ti){_dP+="&ti="+_params.discuzParams.ti}if(_params.discuzParams.pi){_dP+="&pi="+_params.discuzParams.pi}if(_params.discuzParams.rt){_dP+="&rt="+_params.discuzParams.rt}if(_params.discuzParams.md){_dP+="&md="+_params.discuzParams.md}if(_params.discuzParams.nt){_dP+="&nt="+_params.discuzParams.nt}if(_params.discuzParams.pn){_dP+="&pn="+_params.discuzParams.pn}if(_params.discuzParams.qq){_dP+="&qq="+_params.discuzParams.qq}if(_params.discuzParams.on){_dP+="&on="+_params.discuzParams.on}if(_params.discuzParams.r2){_dP+="&r2="+_params.discuzParams.r2}if(_params.discuzParams.logo){this.ctrlLogo(_params.discuzParams.logo)}}return _dP},ctrlLogo:function(c_params){var src,style,swi=c_params?c_params:1;switch(swi){case 0:break;case 9:src="腾讯分析";style="word";break;case 10:src="网站统计";style="word";break;default:src="http://tcss.qq.com/icon/toss_"+swi+".gif";style="pic";break}this.creatLogo(style,src)},creatLogo:function(style,src){var child,sonChild,phParent=document.getElementById("tcss").parentNode;child=document.createElement("a");child.href="http://stats.discuz.qq.com?ADTAG=FROUM.FOOTER.CLICK.ICON";child.title="腾讯分析";child.target="_blank";switch(style){case"word":var text=document.createTextNode(src);child.appendChild(text);break;case"pic":sonChild=document.createElement("img");sonChild.title="腾讯分析";sonChild.src=src;sonChild.border=0;child.appendChild(sonChild);break;default:break}phParent.replaceChild(child,document.getElementById("tcss"))},getDomainInfo:function(hot){var dm,url;_curDomain=dm=_l.host;dm=_curDomain.toLowerCase();if(!_domainToSet){_domainToSet=this.getCookieSetDomain()}url=this.getCurrentUrl();return("dm="+dm+"&url="+url)},getCurrentUrl:function(){var url="";var arg=_n;if(_params.virtualURL){url=_params.virtualURL}else{url=_curUrl=escape(_l.pathname);if(_l.search!=""){arg=escape(_l.search.substr(1))}if(_params.senseParam){var value=this.getParameter(_params.senseParam,_d.URL);if(value){url+="_"+value}}}return url+"&arg="+arg},getRefInfo:function(params){var refdm=_n,refurl=_n,refarg=_n,refStr=_d.referrer,tagParamName,adtag,pos;var ADTAG=_n;_refDomain=params.virtualRefDomain?params.virtualRefDomain:"";_refUrl=params.virtualRefURL?params.virtualRefURL:"";tagParamName=params.tagParamName||"ADTAG";adtag=this.getParameter(tagParamName,_d.URL);if(adtag){ADTAG=adtag}pos=refStr.indexOf("://");if(pos>-1){var re=/(\w+):\/\/([^\:|\/]+)(\:\d*)?(.*\/)([^#|\?|\n]+)?(#.*)?(\?.*)?/i;var arr=refStr.match(re);if(arr){refdm=arr[2];refurl=arr[4]+arr[5]}}if(refStr.indexOf("?")!=-1){var pos=refStr.indexOf("?")+1;refarg=refStr.substr(pos)}if(_refDomain!=""&&params.useCookie=="false"){refdm=_refDomain}if(_refUrl!=""&&params.useCookie=="false"){refurl=_refUrl}_refDomain=refdm;_refUrl=escape(refurl);return("&rdm="+_refDomain+"&rurl="+_refUrl+"&adt="+ADTAG+"&rarg="+escape(refarg))},getMainEnvInfo:function(){var ret="";try{var scr=_n,scl=_n,lang=_n,cpuc=_n,pf=_n,tz=_n,java=0,n=navigator;if(self.screen){scr=screen.width+"x"+screen.height;scl=screen.colorDepth+"-bit"}if(n.language){lang=n.language.toLowerCase()}else{if(n.browserLanguage){lang=n.browserLanguage.toLowerCase()}}java=n.javaEnabled()?1:0;pf=n.platform;tz=new Date().getTimezoneOffset()/60;if(window.external&&window.external.twGetRunPath){var r=external.twGetRunPath();if(r&&r.toLowerCase().indexOf("360se")>-1){_bc=1}}ret="&scr="+scr+"&scl="+scl+"&lg="+lang+"&jv="+java+"&pf="+pf+"&tz="+tz}catch(e){}finally{return ret}},getExtendEnvInfo:function(){var ret="";try{var flash,currentUrl=_l.href,connectType=_n;ret+="&fl="+this.getFlashInfo();if(_b.addBehavior){_b.addBehavior("#default#homePage");if(_b.isHomePage(currentUrl)){ret+="&hp=Y"}}if(_b.addBehavior){_b.addBehavior("#default#clientCaps");connectType=_b.connectionType}ret+="&ct="+connectType}catch(e){}finally{return ret}},getFlashInfo:function(){var f=_n,n=navigator;try{if(n.plugins&&n.plugins.length){for(var i=0;i<n.plugins.length;i++){if(n.plugins[i].name.indexOf("Shockwave Flash")>-1){f=n.plugins[i].description.split("Shockwave Flash ")[1];break}}}else{if(window.ActiveXObject){for(var i=12;i>=5;i--){try{var fl=eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+i+"');");if(fl){f=i+".0";break}}catch(e){}}}}}catch(e){}return f},getParameter:function(name,src){if(name&&src){var r=new RegExp("(\\?|#|&)"+name+"=([^&^#]*)(#|&|$)");var m=src.match(r);return m?m[2]:""}return""},getCookieSetDomain:function(){var dotlen,pos,domainToSet,dot=[],j=0;for(var i=0;i<_curDomain.length;i++){if(_curDomain.charAt(i)=="."){dot[j]=i;j++}}dotlen=dot.length;if(dotlen==1){domainToSet=_curDomain}else{pos=_curDomain.indexOf(".cn")!=-1?1:0;domainToSet=_curDomain.substring(dot[dotlen-2-pos]+1)}return domainToSet},sendClick:function(adid){var sendUrl,vr2,vad;var extParams=[];sendUrl=typeof(_image)=="undefined"?"":_image.src;if(""!=sendUrl){vr2=this.getParameter("r2",sendUrl);sendUrl=sendUrl.replace("r2="+vr2,"r2=a"+vr2.replace(/a/g,""));vext=this.getParameter("ext",sendUrl);extParams=vext.split(";");for(var i=0;i<extParams.length;i++){if(extParams[i].indexOf("adid=")!=-1){extParams[i]="adid="+adid}}sendUrl=sendUrl.replace("ext="+vext,"ext="+extParams.join(";"));this.sendInfo(sendUrl)}},sendInfo:function(url){_image=new Image(1,1);_image.src=url}};var _ad={ids:[],times:{},isExsited:function(e){for(var i=0;i<this.ids.length;i++){if(e==this.ids[i]){return true}}return false},getAdidCollection:function(){if(typeof(_taadHolders)!="undefined"&&_taadHolders.length>0){for(var i=0;i<_taadHolders.length;i++){if(!this.isExsited(_taadHolders[i])){this.ids.push(_taadHolders[i]);this.times[_taadHolders[i]]=1}else{this.times[_taadHolders[i]]=this.times[_taadHolders[i]]+1}}}else{return""}},getFinalStr:function(){this.getAdidCollection();var str="";for(var i=0;i<this.ids.length;i++){this.ids[i]=this.ids[i]+"*"+this.times[this.ids[i]]}return";adid="+this.ids.join(":")}};var _cookie={sck:[],sco:{},init:function(){var value=this.get("pgv_info=",true);if(value!=_n){var arr=value.split("&");for(var i=0;i<arr.length;i++){var arr2=arr[i].split("=");this.set(arr2[0],unescape(arr2[1]))}}},get:function(name,isend){var cookies=isend?_d.cookie:this.get("pgv_info=",true);var value=_n;var offset,end;offset=cookies.indexOf(name);if(offset>-1){offset+=name.length;end=cookies.indexOf(";",offset);if(end==-1){end=cookies.length}if(!isend){var end2=cookies.indexOf("&",offset);if(end2>-1){end=Math.min(end,end2)}}value=unescape(cookies.substring(offset,end))}return value},set:function(key,value){this.sco[key]=value;var isExist=false;var sckLen=this.sck.length;for(var i=0;i<sckLen;i++){if(key==this.sck[i]){isExist=true;break}}if(!isExist){this.sck.push(key)}},setCookie:function(name,isend){var id=_cookie.get(name+"=",isend);if(id==_n){isend?id="":id="s";var curDate=new Date();var curMs=curDate.getUTCMilliseconds();id+=(Math.round(Math.abs(Math.random()-1)*2147483647)*curMs)%10000000000}if(isend){this.saveCookie(name+"="+id,"expires=Sun, 18 Jan 2038 00:00:00 GMT;")}else{this.set(name,id)}return id},save:function(){if(_params.sessionSpan){var expires=new Date();expires.setTime(expires.getTime()+(_params.sessionSpan*60*1000))}var cookies="";var sckLen=this.sck.length;for(var i=0;i<sckLen;i++){cookies+=this.sck[i]+"="+this.sco[this.sck[i]]+"&"}cookies="pgv_info="+cookies.substr(0,cookies.length-1);var expire="";if(expires){expire="expires="+expires.toGMTString()}this.saveCookie(cookies,expire)},saveCookie:function(cookie,expires){_d.cookie=cookie+";path=/;domain="+_domainToSet+";"+expires}};window.pgvMain=function(params){try{new tcss(params).run()}catch(e){}};window.pgvSendClick=function(params){new tcss().sendClick(params)};window.pgvWatchClick=function(params){new tcss(params).watchClick(params)}})();